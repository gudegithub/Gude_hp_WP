(function(b){var a=b.fitSidebar=function(f,d){var g=this,h=g.config=b.extend({},a.defaults,d);h.target=b(f).addClass("fit-sidebar");h.blank=b("<div/>").addClass(a.id+"-blank").insertBefore(h.target);h.blank.css({width:h.target.width(),"float":h.target.css("float")});h.wrapper=b(h.target).parents(h.wrapper);h._win=b(window).on("scroll",function(){g.adjustPosition()}).on("resize",function(){h.target.hasClass("for-chrome-bug");g.adjustPosition()});setTimeout(function(){g.adjustPosition()},0);if(h.target.css("float")=="right"){var e=parseInt(h.wrapper.innerWidth(),10)-parseInt(h.target.innerWidth(),10);h.target.css("margin-left",e+"px")}};b.extend(b.fitSidebar.prototype,{adjustPosition:function(){var j=this,k=j.config;if(k._win.width()<k.responsiveWidth){k.wrapper.removeClass(k.fixedClassName);k.wrapper.addClass(k.noFixedClassName);k.target.removeClass(a.id+"-fixed");k.blank.hide();k.target.width("auto");k.direction=null;return}k.wrapper.addClass(k.fixedClassName);k.wrapper.removeClass(k.noFixedClassName);k.target.addClass(a.id+"-fixed");var i=k.blank.show().offset();var h=k._win.scrollTop();var g=k.target.outerHeight();if(g>k._win.height()){g+=k.offset_top}var f=g-k._win.height();if(f<0){f=0}if(!k.direction){k.lastFixedTop=k.lastDownFixedTop=k.lastUpFixedTop=i.top-h;k.lastScrollTop=k.lastDownScrollTop=k.lastUpScrollTop=h}k.target.width(k.blank.width());k.blank.height(k.target.height());k.direction=h<k.lastScrollTop?"up":"down";var d=function(){var l=k.lastUpFixedTop+(k.lastUpScrollTop-h);if(l<k.offset_top){if(l+f<k.offset_top){l=-f+k.offset_top;var c=k.wrapper.offset().top+k.wrapper.height();var m=h+g+l;if(m>c){l=(c-h)-g}}}k.target.css({top:l,bottom:"auto"});k.lastDownFixedTop=l;k.lastDownScrollTop=h};var e=function(){var c=k.lastDownFixedTop+(k.lastDownScrollTop-h);if(c>k.offset_top){c=i.top-h;if(c<k.offset_top){c=k.offset_top}}k.target.css({top:c,bottom:"auto"});k.lastUpFixedTop=c;k.lastUpScrollTop=h};if(k.direction=="down"){d()}else{e()}k.lastFixedTop=top;k.lastScrollTop=h}});b.fn.fitSidebar=function(c){return this.each(function(){var d=b(this);d.data(a.id,new b.fitSidebar(d,c))})};b.extend(a,{defaults:{wrapper:"body",responsiveWidth:0,fixedClassName:"fit-sidebar-fixed-now",noFixedClassName:"fit-sidebar-no-fixed-now",offset_top:0},id:"fit-sidebar"})})(jQuery);